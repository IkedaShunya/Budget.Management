<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<!--  <link th:href="@{/css/editUser.css}" rel="stylesheet" />-->
  <title>予算入力</title>
  <script>
    // 金額の入力を制限し、フォーマットを適用
    function restrictAndFormat(input) {
        // 入力値から数値以外の文字を削除
        let value = input.value.replace(/[^0-9]/g, '');

        // コンマ区切りフォーマットを適用
        input.value = new Intl.NumberFormat().format(value);
    }
  </script>
</head>
<body>
<h1>予算入力</h1>
<form th:action="@{/category/insert/execute}" th:object="${budgetList}" method="post">
  <h2>収入</h2>
  <table  border="1">
    <thead>
    <tr>
      <th>形態</th>
      <th>項目名</th>
      <th>金額 (円)</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each ="incomeBudget, iterStat: *{incomeBudgets}">
      <td>
        <input type="hidden" th:field="*{incomeBudgets[__${iterStat.index}__].categoryId}" th:value="${incomeBudget.categoryId}" />
        <input type="hidden" th:field="*{incomeBudgets[__${iterStat.index}__].userId}" th:value="${incomeBudget.userId}" />
        <span th:text="${incomeBudget.isRegularIncome == 1 ? '定期' : (incomeBudget.isRegularIncome == 0 ? '不定期' : null)}"></span>
      </td>
      <td>
        <span th:text="${incomeBudget.categoryName}"></span>
      </td>
      <td> <input type="number"
                  id="inamount"
                  th:field="*{incomeBudgets[__${iterStat.index}__].budgetAmount}"
                  th:value="${incomeBudget.estimatedAmount}"
                  oninput="restrictAndFormat(this)"
                  placeholder="金額を入力してください"
                  autocomplete="off" />
      </td>
    </tr>
    </tbody>
  </table>

  <h2>支出</h2>
  <table  border="1">
    <thead>
    <tr>
      <th>費用区分</th>
      <th>カテゴリ名</th>
      <th>金額 (円)</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each ="expenseBudget, iterStat: ${expenseBudgetList}">
      <td>
        <input type="hidden" th:field="*{expenseBudgets[__${iterStat.index}__].categoryId}" th:value="${expenseBudget.categoryId}" />
        <input type="hidden" th:field="*{expenseBudgets[__${iterStat.index}__].userId}" th:value="${expenseBudget.userId}" />
        <span th:text="${expenseBudget.isFixedCost == 1 ? '固定費' : (expenseBudget.isFixedCost == 0 ? '変動費' : null)}"></span>
      </td>
      <td>
        <span th:text="${expenseBudget.categoryName}"></span>
      </td>
      <td>
        <input type="text"
                  id="examount"
                  th:field="*{expenseBudgets[__${iterStat.index}__].budgetAmount}"
                  th:value="${expenseBudget.estimatedAmount}"
                  oninput="restrictAndFormat(this)"
                  placeholder="金額を入力してください"
                  autocomplete="off"
        />
      </td>
    </tr>
    </tbody>
  </table>
  <button type="submit">送信</button>
</form>
<!-- 戻るボタン -->
<a th:href="@{/category/list}" class="cancel-btn">キャンセル</a>
</body>
</html>